# This is a script to create a [parchive][1] of given file(s)/folder(s).
# On input, it will tar the files, run `par2` on them to create a parchive,
# tar all output files together, then encrypt the output.
#
# This requires [aescrypt][2] and [par2][1] to already be installed and callable
# with those names.
#
# Script should be called like the following:
# ```
# par-crypt <password> <output-filename> <input-files...>
# ```
#
# Links:
# [1]:https://github.com/Parchive/par2cmdline
# [2]:https://www.aescrypt.com/linux_aes_crypt.html

# If any command fails, just abort the whole switch
set -e

# Check we have the correct number of arguments
if [[ $# -lt 3 ]]; then
    echo "[ERROR] - Calling command should be $0 <password> <output-filename> <input-files...>";
    echo "Unrecoverable error occurred. Aborting";
    exit;
fi

# Check for required commands
type -p aescrypt >/dev/null 2>&1 || { echo "[ERROR] - aescrypt is required. Aborting." >&2; }
type -p tar >/dev/null 2>&1 || { echo "[ERROR] - tar is required. Aborting." >&2; }
type -p par2 >/dev/null 2>&1 || { echo "[ERROR] - par2 is required. Aborting." >&2; }
